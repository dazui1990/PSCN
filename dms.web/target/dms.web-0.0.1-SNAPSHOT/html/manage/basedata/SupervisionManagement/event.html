<div class="dms-add" id="addAgenda">
	
	<form class="form-horizontal" id="Agenda">
		
		<input type="hidden" class="form-control" id="agendaDatePlan" name="agendaDate"
			value=''/>
			<input type="hidden" class="form-control" id="sta" name="sta"
			value=''/>
			<input type="hidden" class="form-control" id="stb" name="stb"
			value=''/>
			<input type="hidden" class="form-control" id="stc" name="stc"
			value=''/>
			<input type="hidden" class="form-control" id="st" name="st"
			value=''/>
			<input type="hidden" class="form-control" id="chkValue1" name="chkValue1"
			value=''/>
			<input type="hidden" class="form-control" id="chkValue2" name="chkValue2"
			value=''/>
			<input type="hidden" class="form-control" id="otherchkValue1" name="otherchkValue1"
			value=''/>
			<input type="hidden" class="form-control" id="otherchkValue2" name="otherchkValue2"
			value=''/>
		<div id="prompt1" style="text-align: center;height:200px;width: 100%;line-height: 200px;display:none">
			<span style="color:#F00;font-size: 30px;"><strong>无法添加过去时间段计划</strong></span>
		</div> 
		<div class="modal-header">
			<div class="modal-title">
				<span id="title"></span>
			</div>
			
		</div>
		<div class="panel panel-default">
	     <div class="panel-body">
	     <br>
		 <br>
		 <div style="display:block" id="body1">
		 	<input type="hidden" id="agendaId1" name="agendaId1" >
	     	<div class="row">
	     		<label class="control-label col-sm-1">时间:</label>
				<div class="col-xs-4 col-sm-4"><!-- 不同分辨率下自适应宽度，从小到大  -->
					<div class="query-btn">
					<div class="col-xs-8 col-sm-6">
						<div class="input-group date date-picker" data-defaultToday = "true">
							<input id="releaseTimez1" name="releaseTimez1"  readonly="readonly"
								class="form-control" type="text" value="" />
							 <span
								class="input-group-btn">
								<button id="releaseTimezBut1" class="btn default date-set" type="button">
									<i class="fa fa-calendar"></i>
								</button>
							</span>
						</div>
					</div>
					<div class="col-xs-4">
								<select id="item_types1" name="item_types1" class="bs-select form-control" data-existsDefault="false" data-dictCode="2007"></select>
								<!--   模糊查询  multiple  多选  data-existsDefault  请选择  data-size="2"  下拉框显示两条-->
					</div>
					</div>
				</div>
				<label style="text-align: left" class="control-label col-xs-1 col-sm-1">~~</label>
				<div class="col-xs-4 col-sm-4">
					<div class="query-btn">
						<div class="col-xs-8 col-sm-6">
							<div class="input-group date date-picker" data-defaultToday = "false">
								<input id="releaseTime1" name="releaseTime1"  readonly="readonly"
									class="form-control" type="text" value="" />
								 <span
									class="input-group-btn">
									<button id="releaseTimeBut1" class="btn default date-set" type="button">
										<i class="fa fa-calendar"></i>
									</button>
								</span>
							</div>
						</div>
						<div class="col-xs-4">
								<select id="item_typex1" name="item_typex1" class="bs-select form-control" data-existsDefault="false" data-dictCode="2007"></select>
								<!--   模糊查询  multiple  多选  data-existsDefault  请选择  data-size="2"  下拉框显示两条-->
							</div>
					</div>
				</div>	
				<div class="col-xs-1 col-sm-1" style="text-align: right">
				<a href="javascript:;" class="fa fa-remove ajaxrest" style="display: none;" data-callBack="true" id="delete1"  data-url="" data-model="manage" data-method="POST">删除</a></div>
			</div>
			<br>
			<div class="row">
	     		<label class="control-label col-sm-1">特约店:</label>
				<div class="col-xs-12 col-sm-4">
					<div class="query-btn">
						<div class="col-xs-12 ">
							<select id="dealer_id1"
								class="bs-select form-control" name="dealer_id1"
								data-url="/supervision/dealer/agendas/dudao"
								data-model="manage" data-labelValue="DEALER_ID"
								data-lableDesc="DEALER_SHORTNAME" data-live-search="true"  data-size="10" data-existsDefault = "true">
							</select>
							<!--   模糊查询  multiple  多选  data-existsDefault  请选择  data-size="2"  下拉框显示两条-->
						</div>
					</div>
				</div>	
			</div>
			<br>
			<div class="row">
	     		<label class="control-label col-sm-1">事项:</label>
				<div class="col-xs-12 col-sm-8 ">
					<div class="form-group">
						<div class="col-xs-12">
						<input id="region1" name="region1" type="checkbox"
								data-dictCode="9001" data-allFlag="false"
								 />
						</div>
					</div>
				</div>	
			</div>
				<div class="row" id="otherid1">
	     		<label class="control-label col-sm-2">选择其他评价表:</label>
				<div class="col-xs-12 col-sm-8">
					<div class="form-group">
						<div class="col-xs-12" id="othermodeid1">
						
						</div>
					</div>
				</div>	
			</div>
			<div class="row">
	     		<label class="control-label col-sm-1">说明:</label>
				<div class="col-xs-12 col-sm-4">
					<div class="form-group">
						<div class="col-xs-12 col-sm-12">
						<textarea id="remindercontent1" name="remindercontent1" class="form-control" style="height:100px;"></textarea>
						</div>
					</div>
				</div>	
			</div>
			</div>
			<br>
			<br>
			<div style="display:block" id="body2">
			<input type="hidden" id="agendaId2" name="agendaId2" >
	     	<div class="row">
	     		<label class="control-label col-sm-1">时间:</label>
				<div class="col-xs-4 col-sm-4"><!-- 不同分辨率下自适应宽度，从小到大  -->
					<div class="query-btn">
					<div class="col-xs-8  col-sm-6">
						<div class="input-group date date-picker" data-defaultToday = "true">
							<input id="releaseTimez2" name="releaseTimez2"  readonly="readonly"
								class="form-control" type="text" value="" />
							 <span
								class="input-group-btn">
								<button id="releaseTimezBut2" class="btn default date-set" type="button">
									<i class="fa fa-calendar"></i>
								</button>
							</span>
						</div>
					</div>
					<div class="col-xs-4">
								<select id="item_types2" name="item_types2" class="bs-select form-control " data-existsDefault="false" data-dictCode="2007"></select>
								<!--   模糊查询  multiple  多选  data-existsDefault  请选择  data-size="2"  下拉框显示两条-->
					</div>
					</div>
				</div>
				<label style="text-align: left" class="control-label col-xs-1 col-sm-1">~~</label>
				<div class="col-xs-4 col-sm-4">
					<div class="query-btn">
						<div class="col-xs-8 col-sm-6">
							<div class="input-group date date-picker" data-defaultToday = "false">
								<input id="releaseTime2" name="releaseTime2"  readonly="readonly"
									class="form-control" type="text" value="" />
								 <span
									class="input-group-btn">
									<button id="releaseTimeBut2" class="btn default date-set" type="button">
										<i class="fa fa-calendar"></i>
									</button>
								</span>
							</div>
						</div>
						<div class="col-xs-4">
								<select id="item_typex2" name="item_typex2" class="bs-select form-control" data-existsDefault="false" data-dictCode="2007"></select>
								<!--   模糊查询  multiple  多选  data-existsDefault  请选择  data-size="2"  下拉框显示两条-->
							</div>
					</div>
				</div>	
				<div class="col-xs-1 col-sm-1" style="text-align: right">
				<a href="javascript:;" class="fa fa-remove  ajaxrest" style="display: none;" data-callBack="true" id="delete2"  data-url="" data-model="manage" data-method="POST">删除</a></div>
			</div>
			<br>
			<div class="row">
	     		<label class="control-label  col-sm-1">特约店:</label>
				<div class="col-xs-12 col-sm-4">
					<div class="query-btn">
						<div class="col-xs-12">
							<select id="dealer_id2"
								class="bs-select form-control"  name="dealer_id2"
								data-url="/supervision/dealer/agendas/dudao"
								data-model="manage" data-labelValue="DEALER_ID"
								data-lableDesc="DEALER_SHORTNAME"  data-live-search="true"  data-size="10" data-existsDefault = "true" >
							</select>
							<!--   模糊查询  multiple  多选  data-existsDefault  请选择  data-size="2"  下拉框显示两条-->
						</div>
					</div>
				</div>	
			</div>
			<br>
			<div class="row">
	     		<label class="control-label col-sm-1">事项:</label>
				<div class="col-xs-12 col-sm-8">
					<div class="form-group">
						<div class="col-xs-12">
						<input id="region2" name="region2" type="checkbox"
								data-dictCode="9001" data-allFlag="false"
								 />
						</div>
					</div>
				</div>	
			</div>
			<div class="row"  id="otherid2" >
	     		<label class="control-label col-sm-2">选择其他评价表:</label>
				<div class="col-xs-12 col-sm-8">
					<div class="form-group">
						<div class="col-xs-12" id="othermodeid2">
						</div>
					</div>
				</div>	
			</div>
			<div class="row">
	     		<label class="control-label col-sm-1">说明:</label>
				<div class="col-xs-12 col-sm-4">
					<div class="form-group">
						<div class="col-xs-12 col-sm-12">
						<textarea id="remindercontent2" name="remindercontent2" class="form-control" style="height:100px;">
						
						</textarea>
						</div>
					</div>
				</div>	
			</div>
			</div>
			<br>
			<br>
		  </div>
		</div>
		<div class="modal-footer">
			<a data-url="/supervision/saveSupervision" data-model="manage"
				data-method="POST" id="add" data-callBack="true" data-beforeRequest="true"
				class="btn blue" data-toggle="confirmation"> <i class="fa fa-save"></i>保存
			</a> 
			<a id="supPage" data-goback="page" href="manage/basedata/SupervisionManagement/supervisionAgenda.html" class="btn blue ajaxify">
						<i class="fa fa-reply"></i>返回
					</a>
		</div>
	</form>
</div>
<script src="../assets/moment/moment.js" type="text/javascript"></script>
<script src="../assets/layer/layer.js" type="text/javascript"></script>
<script type="text/javascript">
function deleteBody(obj){
	$("#body"+obj).hide();
}
	//页面加载后初始化
	$(document).one("onload.dms",function(event, container) {
		$("#otherid1",container).hide();
		$("#otherid2",container).hide();
		//是否确认选择其他督导特约店
		$("#dealer_id1", container).change(function(){
			var dealerId1 = $("#dealer_id1", container).selectpicker('val');
			dmsCommon.ajaxRestRequest({
			url : dmsCommon.getDmsPath()["manage"] + "/supervision/dealer/agenda/"+dealerId1,
			dataType:"json",
			type:"GET",
			async:true,
			container:container,
			sucessCallBack : function(data) {
				if(data==0){
					layer.confirm('该店不是您负责的店，确认选择?', {
						closeBtn: 0,
						btn: ['是','否'] //按钮
					}, function(){//是
						layer.closeAll();
					}, function(){//否
						$("#dealer_id1", container).selectpicker('val',null);
					});
				}
			}
			});
		});
		
		$("#dealer_id2", container).change(function(){
			var dealerId2 = $("#dealer_id2", container).selectpicker('val');
			dmsCommon.ajaxRestRequest({
			url : dmsCommon.getDmsPath()["manage"] + "/supervision/dealer/agenda/"+dealerId2,
			dataType:"json",
			type:"GET",
			async:true,
			container:container,
			sucessCallBack : function(data) {
				if(data==0){
					layer.confirm('该店不是您负责的店，确认选择?', {
						closeBtn: 0,
						btn: ['是','否'] //按钮
					}, function(){//是
						layer.closeAll();
					}, function(){//否
						$("#dealer_id2", container).selectpicker('val',null);
					});
				}
			}
			});
		});
		var dateStr = $('#agendaDatePlan', container).val();
		//得到当前时间
		var date = new Date();
        var seperator1 = "-";
        var year = date.getFullYear();
        var month = date.getMonth() + 1;
        var strDate = date.getDate();
        if (month >= 1 && month <= 9) {
            month = "0" + month;
        }
        if (strDate >= 0 && strDate <= 9) {
            strDate = "0" + strDate;
        }
        var currentdate = year + seperator1 + month + seperator1 + strDate;
		if(dateStr<currentdate){
			$("#add",container).hide();
		}
		 // 当天上午计划
		
		 dmsCommon.ajaxRestRequest({
			url : dmsCommon.getDmsPath()["manage"] + "/supervision/querySupervisionPlanS/str/"+dateStr,
			dataType:"json",
			type:"GET",
			async:true,
			container:container,
			sucessCallBack : function(data) {
				//resurtMap 当前天的数据   $("#body1")[0].style.display = 'none'; 
				var resultList=data['resultList'];
				if(resultList.length>0){
					//创建未提交 ,驳回 可编辑
					if(resultList[0].STATE==90021001||resultList[0].STATE==90021007){
						$("#agendaId1", container).val(resultList[0].AGENDA_ID);
						$("#releaseTimez1", container).val(resultList[0].START_DATE);
						$("#releaseTime1", container).val(resultList[0].END_DATE);
						$("#item_types1", container).selectpicker('val',resultList[0].START_DATE_NOON);
						$("#item_typex1", container).selectpicker('val',resultList[0].END_DATE_NOON);
						window.setTimeout(function(){
							$("#dealer_id1", container).selectpicker('val',resultList[0].DEALER_ID);
						},1000);
						$("#remindercontent1", container).html(resultList[0].CONTENT);
						var region = resultList[0].TYPE_VALUE.split(",");
						for(var i=0;i<region.length;i++){
							$("input[type=checkbox][name='region1'][value='"+region[i]+"']", container).attr('checked', true);
							if(i==0){
									//查询其他评价表数据，并将其放到div 里面
									dmsCommon.ajaxRestRequest({
									url : dmsCommon.getDmsPath()["manage"] + "/supervision/searchotherEvaluateModleIds",
									dataType:"json",
									type:"GET",
									async:true,
									container:container,
									sucessCallBack : function(data) {
										var html="";
										 for (var i = 0; i <data.length; i++) {
											var othercheck = resultList[0].REMARK.split("s");
											var flag=false;
											 for (var j = 0; j <othercheck.length; j++) {
												 if(data[i].id==othercheck[j]){
												 flag=true;
												 break;//跳出循环
												 }
											 }
											if(flag){
												html='<input type="checkbox" value="'+data[i].id+'"  checked="checked"  name="othermodech1" />'+data[i].evaluate_name+'&nbsp;&nbsp;&nbsp;&nbsp;'+html;
											}else{
												html='<input type="checkbox" value="'+data[i].id+'"   name="othermodech1" />'+data[i].evaluate_name+'&nbsp;&nbsp;&nbsp;&nbsp;'+html;
											}
										}
									$("#othermodeid1").html(html); 
									}
							 }); 
								$("#otherid1", container).show();
							}
						}
						$("#delete1",container).attr("data-url","/supervision/delete/"+resultList[0].AGENDA_ID);
						$("#delete1",container).show();
					$("#sta", container).val("1");
					//已提交,已执行  不可修改
					}else if(resultList[0].STATE==90021005||resultList[0].STATE==90021003||resultList[0].STATE==90021002||resultList[0].STATE==90021004||resultList[0].STATE==90021006||resultList[0].STATE==90021008){
						$("#releaseTimez1", container).val(resultList[0].START_DATE);
						$("#releaseTimez1", container).attr("disabled",true);
						$("#releaseTimezBut1", container).attr("disabled",true);
						$("#releaseTime1", container).val(resultList[0].END_DATE);
						$("#releaseTime1", container).attr("disabled",true);
						$("#releaseTimeBut1", container).attr("disabled",true);
						$("#item_types1", container).selectpicker('val',resultList[0].START_DATE_NOON);
						$("#item_types1", container).attr("disabled",true);
						$("#item_typex1", container).selectpicker('val',resultList[0].END_DATE_NOON);
						$("#item_typex1", container).attr("disabled",true);
						window.setTimeout(function(){
							$("#dealer_id1", container).selectpicker('val',resultList[0].DEALER_ID);
							$("#dealer_id1", container).attr("disabled",true);
						},1000);
						$("#remindercontent1", container).html(resultList[0].CONTENT);
						$("#remindercontent1", container).attr("disabled",true);
						var region = resultList[0].TYPE_VALUE.split(",");
						for(var i=0;i<region.length;i++){
							$("input[type=checkbox][name='region1'][value='"+region[i]+"']", container).attr('checked', true);
							if(i==0){
								//查询其他评价表数据，并将其放到div 里面
								dmsCommon.ajaxRestRequest({
								url : dmsCommon.getDmsPath()["manage"] + "/supervision/searchotherEvaluateModleIds",
								dataType:"json",
								type:"GET",
								async:true,
								container:container,
								sucessCallBack : function(data) {
									var html="";
									 for (var i = 0; i <data.length; i++) {
										var othercheck = resultList[0].REMARK.split("s");
										var flag=false;
										 for (var j = 0; j <othercheck.length; j++) {
											 if(data[i].id==othercheck[j]){
											 flag=true;
											 break;//跳出循环
											 }
										 }
										if(flag){
											html='<input type="checkbox" value="'+data[i].id+'"  checked="checked"  name="othermodech1" />'+data[i].evaluate_name+'&nbsp;&nbsp;&nbsp;&nbsp;'+html;
										}else{
											html='<input type="checkbox" value="'+data[i].id+'"   name="othermodech1" />'+data[i].evaluate_name+'&nbsp;&nbsp;&nbsp;&nbsp;'+html;
										}
									}
								$("#othermodeid1").html(html); 
								}
						 }); 
							$("#otherid1", container).show();
						}
						}
						$("input[name='region1']", container).attr("disabled",true);
					$("#sta", container).val("2");
					//已审批，可变更
					}
				}else{
					$("#releaseTimez1", container).val(dateStr);
				}
			}
		}); 
		// 当天上午计划
		 dmsCommon.ajaxRestRequest({
			url : dmsCommon.getDmsPath()["manage"] + "/supervision/querySupervisionPlanX/str/"+dateStr,
			dataType:"json",
			type:"GET",
			async:true,
			container:container,
			sucessCallBack : function(data) {
				//resurtMap 当前天的数据   $("#body1")[0].style.display = 'none'; 
				var resultList=data['resultList'];
				if(resultList.length>0){
					//创建未提交 ,驳回 可编辑
					if(resultList[0].STATE==90021001||resultList[0].STATE==90021007){
						$("#agendaId2", container).val(resultList[0].AGENDA_ID);
						$("#releaseTimez2", container).val(resultList[0].START_DATE);
						$("#releaseTime2", container).val(resultList[0].END_DATE);
						$("#item_types2", container).selectpicker('val',resultList[0].START_DATE_NOON);
						$("#item_typex2", container).selectpicker('val',resultList[0].END_DATE_NOON);
						window.setTimeout(function(){
							$("#dealer_id2", container).selectpicker('val',resultList[0].DEALER_ID);
						},1000);
						
						$("#remindercontent2", container).html(resultList[0].CONTENT);
						var region = resultList[0].TYPE_VALUE.split(",");
						for(var i=0;i<region.length;i++){
							$("input[type=checkbox][name='region2'][value='"+region[i]+"']", container).attr('checked', true);
							if(i==0){
								//查询其他评价表数据，并将其放到div 里面
								dmsCommon.ajaxRestRequest({
								url : dmsCommon.getDmsPath()["manage"] + "/supervision/searchotherEvaluateModleIds",
								dataType:"json",
								type:"GET",
								async:true,
								container:container,
								sucessCallBack : function(data) {
									var html="";
									 for (var i = 0; i <data.length; i++) {
										var othercheck = resultList[0].REMARK.split("s");
										var flag=false;
										 for (var j = 0; j <othercheck.length; j++) {
											 if(data[i].id==othercheck[j]){
											 flag=true;
											 break;//跳出循环
											 }
										 }
										if(flag){
											html='<input type="checkbox" value="'+data[i].id+'"  checked="checked"  name="othermodech2" />'+data[i].evaluate_name+'&nbsp;&nbsp;&nbsp;&nbsp;'+html;
										}else{
											html='<input type="checkbox" value="'+data[i].id+'"   name="othermodech2" />'+data[i].evaluate_name+'&nbsp;&nbsp;&nbsp;&nbsp;'+html;
										}
									}
								$("#othermodeid2").html(html); 
								}
						 }); 
							$("#otherid2", container).show();
						}
						}
						$("#delete2",container).attr("data-url","/supervision/delete/"+resultList[0].AGENDA_ID);
						$("#delete2",container).show();
						$("#stb", container).val("1");
					//已提交,已执行  不可修改
					}else if(resultList[0].STATE==90021005||resultList[0].STATE==90021002||resultList[0].STATE==90021004||resultList[0].STATE==90021006||resultList[0].STATE==90021003||resultList[0].STATE==90021008){
						$("#releaseTimez2", container).val(resultList[0].START_DATE);
						$("#releaseTimez2", container).attr("disabled",true);
						$("#releaseTimezBut2", container).attr("disabled",true);
						$("#releaseTime2", container).val(resultList[0].END_DATE);
						$("#releaseTime2", container).attr("disabled",true);
						$("#releaseTimeBut2", container).attr("disabled",true);
						$("#item_types2", container).selectpicker('val',resultList[0].START_DATE_NOON);
						$("#item_types2", container).attr("disabled",true);
						$("#item_typex2", container).selectpicker('val',resultList[0].END_DATE_NOON);
						$("#item_typex2", container).attr("disabled",true);
						window.setTimeout(function(){
							$("#dealer_id2", container).selectpicker('val',resultList[0].DEALER_ID);
							$("#dealer_id2", container).attr("disabled",true);
						},1000);
						$("#remindercontent2", container).html(resultList[0].CONTENT);
						$("#remindercontent2", container).attr("disabled",true);
						var region = resultList[0].TYPE_VALUE.split(",");
						for(var i=0;i<region.length;i++){
							$("input[type=checkbox][name='region2'][value='"+region[i]+"']", container).attr('checked', true);
							if(i==0){
								//查询其他评价表数据，并将其放到div 里面
								dmsCommon.ajaxRestRequest({
								url : dmsCommon.getDmsPath()["manage"] + "/supervision/searchotherEvaluateModleIds",
								dataType:"json",
								type:"GET",
								async:true,
								container:container,
								sucessCallBack : function(data) {
									var html="";
									 for (var i = 0; i <data.length; i++) {
										var othercheck = resultList[0].REMARK.split("s");
										var flag=false;
										 for (var j = 0; j <othercheck.length; j++) {
											 if(data[i].id==othercheck[j]){
											 flag=true;
											 break;//跳出循环
											 }
										 }
										if(flag){
											html='<input type="checkbox" value="'+data[i].id+'"  checked="checked"  name="othermodech2" />'+data[i].evaluate_name+'&nbsp;&nbsp;&nbsp;&nbsp;'+html;
										}else{
											html='<input type="checkbox" value="'+data[i].id+'"   name="othermodech2" />'+data[i].evaluate_name+'&nbsp;&nbsp;&nbsp;&nbsp;'+html;
										}
									}
								$("#othermodeid2").html(html); 
								}
						 }); 
							$("#otherid2", container).show();
						}
						}
						$("input[type=checkbox][name='region2']", container).attr("disabled",true);
						$("#stb", container).val("2");
					//已审批，可变更
					}
				}else{
					$("#releaseTimez2", container).val(dateStr);
				}
			}
		}); 
		queryQuanVal();
		//当天为新增时或者上下午为相同计划时，隐掉第二个body
		function queryQuanVal(){
		 dmsCommon.ajaxRestRequest({
				url : dmsCommon.getDmsPath()["manage"] + "/supervision/querySupervisionPlan/str/"+dateStr,
				dataType:"json",
				type:"GET",
				async:true,
				container:container,
				sucessCallBack : function(data) {
					if(data==2){
						$("#body2", container).hide();
						$("#stb", container).val("3");
						//$("#releaseTimez1", container).val(dateStr);
					}else if(data==1&&currentdate>dateStr){
						$("#prompt1", container).show();
						$("#body1", container).hide();
						$("#body2", container).hide();
						$("#stb", container).val("3");
						$("#releaseTimez1", container).val(dateStr);
					}else if(data==1&&currentdate<=dateStr){
						$("#body2", container).hide();
						$("#stb", container).val("3");
						$("#releaseTimez1", container).val(dateStr);
					//为3时上面有计划，下面无计划
					}else if(data==3){
						$("#delete2",container).attr("onclick","deleteBody(2)");
						$("#delete2",container).show();
						//$("#body2", container).hide();
						if(currentdate>=dateStr){
							$("#delete2",container).hide();
						}
					//为4时下面有计划，上面无计划
					}else if(data==4){
						$("#delete1",container).attr("onclick","deleteBody(1)");
						$("#delete1",container).show();
						if(currentdate>dateStr){
							//$("#body1", container).hide();
							$("#delete1",container).hide();
						}
					}
				}
		 }) 
		}
		//保存
		$("a[data-beforeRequest='true']",container).on("beforeRequest.dms",function(event,returnResult){
			var releaseTimez1 = $("#releaseTimez1", container).val();
			var releaseTime1 = $("#releaseTime1", container).val();
			if(currentdate>releaseTimez1){
				alert("不能新增历史时间计划，请重新选择时间！！！");
				return false;
			}
			var item_types1 = $("#item_types1", container).val();
			var item_typex1 = $("#item_typex1", container).val();
			var dealer_id1 = $("#dealer_id1", container).val();
			var remindercontent1 = $("#remindercontent1", container).val();
			var chkValue1 = ""; 
			$('input[name="region1"]:checked', container).each(function(){ 
				chkValue1 = chkValue1 +"s"+$(this).val();
			}); 
			$("#chkValue1", container).val(chkValue1);
			
			
			var otherchkValue1 = ""; 
			$('input[name="othermodech1"]:checked', container).each(function(){ 
				otherchkValue1 = $(this).val()+"s"+otherchkValue1;
			}); 
			$("#otherchkValue1", container).val(otherchkValue1);
			
			var releaseTimez2 = $("#releaseTimez2", container).val();
			var releaseTime2 = $("#releaseTime2", container).val();
			var item_types2 = $("#item_types2", container).val();
			var item_typex2 = $("#item_typex2", container).val();
			var dealer_id2 = $("#dealer_id2", container).val();
			var remindercontent2 = $("#remindercontent2", container).val();
			var chkValue2 = ""; 
			$('input[name="region2"]:checked', container).each(function(){ 
				chkValue2 = $(this).val()+"s"+chkValue2;
			}); 
			$("#chkValue2", container).val(chkValue2);
			
			var otherchkValue2 = ""; 
			$('input[name="othermodech2"]:checked', container).each(function(){ 
				otherchkValue2 = otherchkValue2 +"s"+$(this).val();
			}); 
			$("#otherchkValue2", container).val(otherchkValue2);
			
			
			var sta = $("#sta", container).val();//为1时可修改，为2时不可修改
			var stb = $("#stb", container).val();//为1时可修改，为2时不可修改，为3时bady2被none，为新增页面或者事项为上下午一直页面
			//新增或者为同一天事项
			if(stb==3&&sta==""){
				
				if(releaseTimez1==""||releaseTime1==""||releaseTime1<releaseTimez1){
					alert("时间选择不正确，请选择正确！！！");
					return false;
				}else if(releaseTime1==releaseTimez1&&item_types1>item_typex1){
					alert("上下午选择不正确，请选择正确！！！");
					return false;
				}else if(remindercontent1==""||remindercontent1==""){
					alert("说明不能为空！！！");
					return false;
				}else if(chkValue1==""){
					alert("事项不能为空！！！");
					return false;
				}else if(dealer_id1==""&&(chkValue1.indexOf("90011002") > 0||chkValue1.indexOf("90011004") > 0)){
					alert("事项选择'巡店'或'弱店辅导'特约店不能为空！！！");
					return false;
				}
				$("#stc", container).val("1");//新增
			}else if(stb==3&&sta==1){
				if(releaseTimez1==""||releaseTime1==""||releaseTime1<releaseTimez1){
					alert("时间选择不正确，请选择正确！！！");
					return false;
				}else if(releaseTime1==releaseTimez1&&item_types1>item_typex1){
					alert("上下午选择不正确，请选择正确！！！");
					return false;
				}else if(remindercontent1==""||remindercontent1==""){
					alert("说明不能为空！！！");
					return false;
				}else if(chkValue1==""){
					alert("事项不能为空！！！");
					return false;
				}else if(dealer_id1==""&&(chkValue1.indexOf("90011002") > 0||chkValue1.indexOf("90011004") > 0)){
					alert("事项选择'巡店'或'弱店辅导'特约店不能为空！！！");
					return false;
				}
				$("#stc", container).val("2");//修改上午单条记录
			}else if(stb==3&&sta==2){
				alert("当天无可保存计划！！！")
				return false;
			}
			//当天上午有计划(不可修改计划)，下午没计划
			if(stb==""&&sta==2){
				if($("#body2").css("display")=="none"){
					alert("当天无可保存计划！！！")
					return false;
				}
				if(releaseTime1>releaseTimez2||(releaseTime1==releaseTimez2&&item_typex1>=item_types2)){
					alert("上下计划时间选择不正确，请选择正确！！！");
					return false;
				}
				if(releaseTimez2==""||releaseTime2==""||releaseTime2<releaseTimez2){
					alert("时间选择不正确，请选择正确！！！");
					return false;
				}else if(releaseTime2==releaseTimez2&&item_types2>item_typex2){
					alert("上下午选择不正确，请选择正确！！！");
					return false;
				}else if(remindercontent2==""||remindercontent2==""){
					alert("说明不能为空！！！");
					return false;
				}else if(chkValue2==""){
					alert("事项不能为空！！！");
					return false;
				}else if(dealer_id2==""&&(chkValue2.indexOf("90011002") > 0||chkValue2.indexOf("90011004") > 0)){
					alert("事项选择'巡店'或'弱店辅导'特约店不能为空！！！");
					return false;
				}
				
				$("#stc", container).val("3");//修改下午单条记录
			}
			//当天下午有计划(不可修改计划)，上午没计划	
			if(stb==2&&sta==""){
				if($("#body1").css("display")=="none"){
					alert("当天无可保存计划！！！")
					return false;
				}
				if(releaseTime1>releaseTimez2||(releaseTime1==releaseTimez2&&item_typex1>=item_types2)){
					alert("上下计划时间选择不正确，请选择正确！！！");
					return false;
				}
				if(releaseTimez1==""||releaseTime1==""||releaseTime1<releaseTimez1){
					alert("时间选择不正确，请选择正确！！！");
					return false;
				}else if(releaseTime1==releaseTimez1&&item_types1>item_typex1){
					alert("上下午选择不正确，请选择正确！！！");
					return false;
				}else if(remindercontent1==""||remindercontent1==""){
					alert("说明不能为空！！！");
					return false;
				}else if(chkValue1==""){
					alert("事项不能为空！！！");
					return false;
				}else if(dealer_id1==""&&(chkValue1.indexOf("90011002") > 0||chkValue1.indexOf("90011004") > 0)){
					alert("事项选择'巡店'或'弱店辅导'特约店不能为空！！！");
					return false;
				}
				$("#stc", container).val("2");//修改上午单条记录
			}
			//当天上午有计划(可修改计划)，下午没计划	当天下午有计划(可修改计划)，上午没计划	
			if((stb==""&&sta==1)||(stb==1&&sta=="")||(stb==1&&sta==1)){
				if($("#body1").css("display")!="none"&&$("#body2").css("display")!="none"){
					if(releaseTimez1==""||releaseTime1==""||releaseTime1<releaseTimez1){
						alert("时间选择不正确，请选择正确！！！");
						return false;
					}else if(releaseTime1==releaseTimez1&&item_types1>item_typex1){
						alert("上下午选择不正确，请选择正确！！！");
						return false;
					}else if(remindercontent1==""||remindercontent1==""){
						alert("说明不能为空！！！");
						return false;
					}else if(chkValue1==""){
						alert("事项不能为空！！！");
						return false;
					}else if(dealer_id1==""&&(chkValue1.indexOf("90011002") > 0||chkValue1.indexOf("90011004") > 0)){
						alert("事项选择'巡店'或'弱店辅导'特约店不能为空！！！");
						return false;
					}
					
					if(releaseTime1>releaseTimez2||(releaseTime1==releaseTimez2&&item_typex1>=item_types2)){
						alert("上下计划时间选择不正确，请选择正确！！！");
						return false;
					}
					
					if(releaseTimez2==""||releaseTime2==""||releaseTime2<releaseTimez2){
						alert("时间选择不正确，请选择正确！！！");
						return false;
					}else if(releaseTime2==releaseTimez2&&item_types2>item_typex2){
						alert("上下午选择不正确，请选择正确！！！");
						return false;
					}else if(remindercontent2==""||remindercontent2==""){
						alert("说明不能为空！！！");
						return false;
					}else if(chkValue2==""){
						alert("事项不能为空！！！");
						return false;
					}else if(dealer_id2==""&&(chkValue2.indexOf("90011002") > 0||chkValue2.indexOf("90011004") > 0)){
						alert("事项选择'巡店'或'弱店辅导'特约店不能为空！！！");
						return false;
					}
					$("#stc", container).val("4");//修改两条记录
				}else if($("#body1").css("display")!="none"&&$("#body2").css("display")=="none"){
					if(releaseTimez1==""||releaseTime1==""||releaseTime1<releaseTimez1){
						alert("时间选择不正确，请选择正确！！！");
						return false;
					}else if(releaseTime1==releaseTimez1&&item_types1>item_typex1){
						alert("上下午选择不正确，请选择正确！！！");
						return false;
					}else if(remindercontent1==""||remindercontent1==""){
						alert("说明不能为空！！！");
						return false;
					}else if(chkValue1==""){
						alert("事项不能为空！！！");
						return false;
					}else if(dealer_id1==""&&(chkValue1.indexOf("90011002") > 0||chkValue1.indexOf("90011004") > 0)){
						alert("事项选择'巡店'或'弱店辅导'特约店不能为空！！！");
						return false;
					}
					$("#stc", container).val("2");//修改上午记录
				}else if($("#body1").css("display")=="none"&&$("#body2").css("display")!="none"){
					if(releaseTimez2==""||releaseTime2==""||releaseTime2<releaseTimez2){
						alert("时间选择不正确，请选择正确！！！");
						return false;
					}else if(releaseTime2==releaseTimez2&&item_types2>item_typex2){
						alert("上下午选择不正确，请选择正确！！！");
						return false;
					}else if(remindercontent2==""||remindercontent2==""){
						alert("说明不能为空！！！");
						return false;
					}else if(chkValue2==""){
						alert("事项不能为空！！！");
						return false;
					}else if(dealer_id2==""&&(chkValue2.indexOf("90011002") > 0||chkValue2.indexOf("90011004") > 0)){
						alert("事项选择'巡店'或'弱店辅导'特约店不能为空！！！");
						return false;
					}
					$("#stc", container).val("3");//修改两条记录
				}
				
			}
		$("#st",container).val("1");
		returnResult.status = true;
	});
			
		//保存成功
		$("a[data-callBack='true']", container).on("callBack.dms",function(event, response) {
			//dmsCommon.tip({status:"warning",msg:"保存成功"}); 前台自定义弹窗提示
			if($("#st",container).val()=="1"){
				$("#supPage",container).click();
			}else{
				dmsCommon.ajaxPageRequest({
   				url:'manage/basedata/SupervisionManagement/event.html',
   	        	container:$('#funcId_901001'),//定义容器
   	        	success:function(html){
   	        		
   	        	},
   	        	complete:function(xmlRequest, statusCode){
   	        		$("#agendaDatePlan",getParentModal(container)).val(dateStr.format('YYYY-MM-DD'));
   	        	}
   			});	
			}
		});
		
		//其他评价表模板增加
		 $("input[name='region1']",container).on("click",function(event){
			//获取当前勾选的值，如果勾选的值时其他选项的话 则显示，否则隐藏并将值去掉
			//查询出说有的模板ID值 以及名称
			var chkValue1 =""; 
			var otherchkValue1 = ""; 
			$('input[name="othermodech1"]:checked', container).each(function(){ 
				otherchkValue1 = $(this).val()+"s"+otherchkValue1;
			});
			$('input[name="region1"]:checked', container).each(function(){
				chkValue1 = $(this).val()+"s"+chkValue1;
			});
			
			var flag=true;
			var chekvalist = chkValue1.split("s");
			for (var a = 0; a < chekvalist.length; a++) {
					flag=false;
					if(otherchkValue1==""){
						//查询其他评价表数据，并将其放到div 里面
						dmsCommon.ajaxRestRequest({
						url : dmsCommon.getDmsPath()["manage"] + "/supervision/searchotherEvaluateModleIds",
						dataType:"json",
						type:"GET",
						async:true,
						container:container,
						sucessCallBack : function(data) {
							var html="";
							 for (var i = 0; i <data.length; i++) {
								html='<input type="checkbox" value="'+data[i].id+'" name="othermodech1" />'+data[i].evaluate_name+'&nbsp;&nbsp;&nbsp;&nbsp;'+html;
							}
						$("#othermodeid1").html(html); 
						}
				 }); 
				}   
					$("#otherid1", container).show();
					/* if(flag){
						//清空
						$("input[type=checkbox][name='othermodech1']", container).attr('checked', false);
						$("#otherchkValue1", container).val('');
						$("#otherid1", container).hide();
					} */
			}
			if(chkValue1==''){
				$("#otherid1", container).hide();
			}
		});
		
		//其他评价表模板增加
		 $("input[name='region2']",container).on("click",function(event){
			//获取当前勾选的值，如果勾选的值时其他选项的话 则显示，否则隐藏并将值去掉
			//查询出说有的模板ID值 以及名称
			var chkValue2 = ""; 
			var otherchkValue2 = ""; 
			$('input[name="othermodech2"]:checked', container).each(function(){ 
				otherchkValue2 =$(this).val()+"s"+otherchkValue2 ;
			});
			$('input[name="region2"]:checked', container).each(function(){
				chkValue2 = $(this).val() +"s"+chkValue2;
				
			});
			var flag=true;
			var chekvalist = chkValue2.split("s");
			for (var a = 0; a < chekvalist.length; a++) {
					flag=false;
					if(otherchkValue2==""){
						//查询其他评价表数据，并将其放到div 里面
						dmsCommon.ajaxRestRequest({
						url : dmsCommon.getDmsPath()["manage"] + "/supervision/searchotherEvaluateModleIds",
						dataType:"json",
						type:"GET",
						async:true,
						container:container,
						sucessCallBack : function(data) {
							var html="";
							 for (var i = 0; i <data.length; i++) {
								html='<input type="checkbox" value="'+data[i].id+'" name="othermodech2" />'+data[i].evaluate_name+'&nbsp;&nbsp;&nbsp;&nbsp;'+html;
							}
						$("#othermodeid2").html(html); 
						}
				 }); 
				}   
					$("#otherid2", container).show();
					/* if(flag){
						//清空
						$("input[type=checkbox][name='othermodech2']", container).attr('checked', false);
						$("#otherchkValue2", container).val('');
						$("#otherid2", container).hide();
					} */
			}
			if(chkValue1==''){
				$("#otherid2", container).hide();
			}
		});
		
	});
	
</script>
